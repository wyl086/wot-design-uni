import{d as e,r as s,T as a,h as t,j as o,o as l,c as i,w as n,a as u,R as r,p as c,n as d,y as p,a5 as m,ac as f,i as v,L as y,ad as _,ae as h,q as w,v as b,e as g,F as k,f as C,b as F,t as x,u as z,x as T,l as P,g as L,af as D,X as I,z as S,H as M,ag as N}from"./index-3ce4de40.js";import{g as j,Z as E,c as U,b as K,r as R,K as A,i as $,l as H,m as G,o as O,P as X,$ as q,C as Q,Q as V,a0 as Z,a1 as B,t as J}from"./page-wraper.87c317ef.js";import{u as W}from"./useTranslate.26b7af52.js";const Y=K(e({name:"wd-video-preview",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...j},setup(e,{expose:y}){const _=s(!1),h=a({url:"",poster:"",title:""});function w(){_.value=!1,m((()=>{h.url="",h.poster="",h.title=""}))}return E((()=>_.value)),y({open:function(e){_.value=!0,h.url=e.url,h.poster=e.poster,h.title=e.title},close:w}),(e,s)=>{const a=f,m=v,y=t(o("wd-icon"),U);return _.value?(l(),i(m,{key:0,class:d(`wd-video-preview ${e.customClass}`),style:p(e.customStyle),onClick:w},{default:n((()=>[u(m,{class:"wd-video-preview__video",onClick:s[0]||(s[0]=r((()=>{}),["stop"]))},{default:n((()=>[h.url?(l(),i(a,{key:0,class:"wd-video-preview__video",controls:!0,poster:h.poster,title:h.title,"play-btn-position":"center",enableNative:!0,src:h.url,"enable-progress-gesture":!1},null,8,["poster","title","src"])):c("",!0)])),_:1}),u(y,{name:"close","custom-class":"wd-video-preview__close",onClick:w})])),_:1},8,["class","style"])):c("",!0)}}}),[["__scopeId","data-v-deea6e80"]]);function ee(e){if(R(e.tempFiles)){const s=[];return e.tempFiles.forEach((async e=>{s.push({path:e.path||"",name:e.name||"",size:e.size,type:"image",thumb:e.path||""})})),s}return[{path:e.tempFiles.path||"",name:e.tempFiles.name||"",size:e.tempFiles.size,type:"image",thumb:e.tempFiles.path||""}]}const se=K(e({name:"wd-upload",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...j,fileList:A(),action:$(""),header:{type:Object,default:()=>{}},multiple:H(!1),disabled:H(!1),limit:Number,showLimitNum:H(!0),maxSize:G(Number.MAX_VALUE),sourceType:{type:Array,default:()=>["album","camera"]},sizeType:{type:Array,default:()=>["original","compressed"]},name:$("file"),formData:{type:Object,default:()=>{}},onPreviewFail:Function,beforeUpload:Function,beforeChoose:Function,beforeRemove:Function,beforePreview:Function,buildFormData:Function,loadingType:$("ring"),loadingColor:$("#ffffff"),accept:$("image"),statusKey:$("status"),loadingSize:$("24px"),compressed:H(!0),maxDuration:G(60),camera:$("back"),imageMode:$("aspectFit"),successStatus:G(200),customEvokeClass:$(""),customPreviewClass:$("")},emits:["fail","change","success","progress","oversize","chooseerror","remove"],setup(e,{emit:a}){const r=e,{translate:m}=W("upload"),j=s([]),E=w((()=>!r.limit||j.value.length<r.limit)),K=s();function R(e){return new Promise(((s,a)=>{M({src:e,success:e=>{s(e)},fail:e=>{a(e)}})}))}function A(e){const s={uid:q.id++,name:e.name||"",thumb:e.thumb||"",status:"loading",size:e.size||0,url:e.path,percent:0};j.value.push(s);const{buildFormData:a,formData:t={}}=r;a?a({file:s,formData:t,resolve:e=>{e&&H(s,e)}}):H(s,t)}function $(e,s,t){const{statusKey:o}=r,l=j.value.findIndex((e=>e.uid===s.uid));l>-1&&(j.value[l][o]="fail",j.value[l].error=e.message,j.value[l].response=e,a("fail",{error:e,file:s,formData:t}))}function H(e,s){const{action:t,name:o,header:l={},accept:i}=r,n=J(r.successStatus)?r.successStatus:200;N({url:t,header:l,name:o,fileName:o,fileType:i,formData:s,filePath:e.url,success(t){t.statusCode===n?function(e,s,t){const{statusKey:o}=r,l=j.value.findIndex((e=>e.uid===s.uid));l>-1&&(j.value[l][o]="success",j.value[l].response=e.data,a("change",{fileList:j.value}),a("success",{file:s,fileList:j.value,formData:t}))}(t,e,s):$(t,e,s)},fail(a){$(a,e,s)}}).onProgressUpdate((s=>{!function(e,s){const t=j.value.findIndex((e=>e.uid===s.uid));t>-1&&(j.value[t].percent=e.progress,a("progress",{response:e,file:s}))}(s,e)}))}function G(){const{multiple:e,maxSize:s,accept:t,sizeType:o,limit:l,sourceType:i,compressed:n,maxDuration:u,camera:c,beforeUpload:d}=r;(function({multiple:e,sizeType:s,sourceType:a,maxCount:t,accept:o,compressed:l,maxDuration:i,camera:n}){return new Promise(((u,r)=>{switch(o){case"image":y({count:e?Math.min(t,9):1,sizeType:s,sourceType:a,success:e=>u(ee(e)),fail:e=>{r(e)}});break;case"video":h({sourceType:a,compressed:l,maxDuration:i,camera:n,success:e=>{u(function(e){return[{path:e.tempFilePath||e.filePath||"",name:e.name||"",size:e.size,type:"video",thumb:e.thumbTempFilePath||"",duration:e.duration}]}(e))},fail:r});break;case"all":_({count:e?Math.min(t,100):1,type:o,success:e=>u(e.tempFiles),fail:r});break;default:y({count:e?Math.min(t,9):1,sizeType:s,sourceType:a,success:e=>u(ee(e)),fail:r})}}))})({multiple:e,sizeType:o,sourceType:i,maxCount:l?l-j.value.length:9,accept:t,compressed:n,maxDuration:u,camera:c}).then((t=>{let o=t;e||(o=o.slice(0,1));const l=async e=>{for(let t=0;t<e.length;t++){const o=e[t];if("image"===o.type&&!o.size){const e=await R(o.path);o.size=e.width*e.height}Number(o.size)<=s?A(o):a("oversize",{file:o})}};d?d({files:o,fileList:j.value,resolve:e=>{e&&l(o)}}):l(o)})).catch((e=>{a("chooseerror",{error:e})}))}function se(){if(r.disabled)return;const{beforeChoose:e}=r;e?e({fileList:j.value,resolve:e=>{e&&G()}}):G()}function ae(e,s){j.value.splice(j.value.findIndex((s=>s.uid===e.uid)),1),a("change",{fileList:j.value}),a("remove",{file:e})}function te(e){D({filePath:e.url,showMenu:!0})}function oe(e,s){const{onPreviewFail:a}=r;I({urls:s,current:s[e],fail(){a?a({index:e,imgList:s}):S({title:"预览图片失败",icon:"none"})}})}function le(e,s){var a;null==(a=K.value)||a.open({url:s[e].url,poster:s[e].thumb,title:s[e].name})}function ie(e){const{beforePreview:s}=r,a=j.value.filter((e=>ne(e))),t=a.findIndex((s=>s.url===e.url));s?s({index:t,imgList:[],resolve:e=>{e&&le(t,a)}}):le(t,a)}function ne(e){return e.name&&Z(e.name)||Z(e.url)}function ue(e){return e.name&&B(e.name)||B(e.url)}return b((()=>r.fileList),(e=>{const{statusKey:s}=r;if(X(e,j.value))return;const a=e.map((e=>(e[s]=e[s]||"success",e.response=e.response||"",{...e,uid:q.id++})));j.value=a}),{deep:!0,immediate:!0}),b((()=>r.limit),(e=>{e&&e<j.value.length&&console.error("[wot-design]Error: props limit must less than fileList.length")}),{deep:!0,immediate:!0}),b((()=>r.beforePreview),(e=>{e&&!Q(e)&&"asyncfunction"!==V(e)&&console.error("The type of beforePreview must be Function")}),{deep:!0,immediate:!0}),b((()=>r.onPreviewFail),(e=>{e&&!Q(e)&&"asyncfunction"!==V(e)&&console.error("The type of onPreviewFail must be Function")}),{deep:!0,immediate:!0}),b((()=>r.beforeRemove),(e=>{e&&!Q(e)&&"asyncfunction"!==V(e)&&console.error("The type of beforeRemove must be Function")}),{deep:!0,immediate:!0}),b((()=>r.beforeUpload),(e=>{e&&!Q(e)&&"asyncfunction"!==V(e)&&console.error("The type of beforeUpload must be Function")}),{deep:!0,immediate:!0}),b((()=>r.beforeChoose),(e=>{e&&!Q(e)&&"asyncfunction"!==V(e)&&console.error("The type of beforeChoose must be Function")}),{deep:!0,immediate:!0}),b((()=>r.buildFormData),(e=>{e&&!Q(e)&&"asyncfunction"!==V(e)&&console.error("The type of buildFormData must be Function")}),{deep:!0,immediate:!0}),(e,s)=>{const a=P,y=t(o("wd-icon"),U),_=v,h=f,w=t(o("wd-loading"),O),b=L,D=t(o("wd-video-preview"),Y);return l(),g(k,null,[u(_,{class:d(["wd-upload",e.customClass]),style:p(e.customStyle)},{default:n((()=>[(l(!0),g(k,null,C(j.value,((s,t)=>(l(),i(_,{class:d(["wd-upload__preview",e.customPreviewClass]),key:t},{default:n((()=>[u(_,{class:"wd-upload__status-content"},{default:n((()=>[ue(s)?(l(),i(a,{key:0,src:s.url,mode:e.imageMode,class:"wd-upload__picture",onClick:e=>function(e){const{beforePreview:s}=r,a=j.value.filter((e=>ue(e))),t=a.findIndex((s=>s.url===e.url));s?s({index:t,imgList:a.map((e=>e.url)),resolve:e=>{e&&oe(t,a.map((e=>e.url)))}}):oe(t,a.map((e=>e.url)))}(s)},null,8,["src","mode","onClick"])):ne(s)?(l(),g(k,{key:1},[s.thumb?(l(),i(_,{key:0,class:"wd-upload__video",onClick:e=>ie(s)},{default:n((()=>[u(a,{src:s.thumb,mode:e.imageMode,class:"wd-upload__picture"},null,8,["src","mode"]),u(y,{name:"play-circle-filled","custom-class":"wd-upload__video-paly"})])),_:2},1032,["onClick"])):(l(),i(_,{key:1,class:"wd-upload__video",onClick:e=>ie(s)},{default:n((()=>[u(h,{src:s.url,title:s.name||"视频"+t,"object-fit":"contain",controls:!1,poster:s.thumb,autoplay:!1,"show-center-play-btn":!1,"show-fullscreen-btn":!1,"show-play-btn":!1,"show-loading":!1,"show-progress":!1,"show-mute-btn":!1,"enable-progress-gesture":!1,enableNative:!0,class:"wd-upload__video"},null,8,["src","title","poster"]),u(y,{name:"play-circle-filled","custom-class":"wd-upload__video-paly"})])),_:2},1032,["onClick"]))],64)):(l(),i(_,{key:2,class:"wd-upload__file",onClick:e=>function(e){const{beforePreview:s}=r,a=j.value.filter((e=>!ne(e)&&!ue(e))).findIndex((s=>s.url===e.url));s?s({index:a,imgList:[],resolve:s=>{s&&te(e)}}):te(e)}(s)},{default:n((()=>[u(y,{name:"file",size:"22px"}),u(_,{class:"wd-upload__file-name"},{default:n((()=>[F(x(s.name||s.url),1)])),_:2},1024)])),_:2},1032,["onClick"]))])),_:2},1024),"success"!==s.status?(l(),i(_,{key:0,class:"wd-upload__mask wd-upload__status-content"},{default:n((()=>["loading"===s.status?(l(),i(_,{key:0,class:"wd-upload__status-content"},{default:n((()=>[u(w,{type:e.loadingType,size:e.loadingSize,color:e.loadingColor},null,8,["type","size","color"]),u(b,{class:"wd-upload__progress-txt"},{default:n((()=>[F(x(s.percent)+"%",1)])),_:2},1024)])),_:2},1024)):c("",!0),"fail"===s.status?(l(),i(_,{key:1,class:"wd-upload__status-content"},{default:n((()=>[u(y,{name:"close-outline","custom-class":"wd-upload__icon"}),u(b,{class:"wd-upload__progress-txt"},{default:n((()=>[F(x(s.error||z(m)("error")),1)])),_:2},1024)])),_:2},1024)):c("",!0)])),_:2},1024)):c("",!0),"loading"===s.status||e.disabled?c("",!0):(l(),i(y,{key:1,name:"error-fill","custom-class":"wd-upload__close",onClick:e=>function(e){const{beforeRemove:s}=r,a=e,t=j.value[a];s?s({file:t,index:a,fileList:j.value,resolve:e=>{e&&ae(t)}}):ae(t)}(t)},null,8,["onClick"]))])),_:2},1032,["class"])))),128)),z(E)?(l(),g(k,{key:0},[e.$slots.default?(l(),i(_,{key:0,class:d(["wd-upload__evoke-slot",e.customEvokeClass]),onClick:se},{default:n((()=>[T(e.$slots,"default",{},void 0,!0)])),_:3},8,["class"])):(l(),i(_,{key:1,onClick:se,class:d(["wd-upload__evoke",e.disabled?"is-disabled":"",e.customEvokeClass])},{default:n((()=>[u(y,{class:"wd-upload__evoke-icon",name:"fill-camera"}),e.limit&&e.showLimitNum?(l(),i(_,{key:0,class:"wd-upload__evoke-num"},{default:n((()=>[F("（"+x(j.value.length)+"/"+x(e.limit)+"）",1)])),_:1})):c("",!0)])),_:1},8,["class"]))],64)):c("",!0)])),_:3},8,["class","style"]),u(D,{ref_key:"videoPreview",ref:K},null,512)],64)}}}),[["__scopeId","data-v-5f67397b"]]);export{se as _};
